<% product_reactions = Reaction.where("product_id = ?", product.id) %>
<!-- for debugging... < % debug =1/0 % >  -->
<tr>
  <% if product_reactions.empty? %>
    <td class="text-color-ok"><%= product.name %></td>
    <td class="text-color-ok"><%= product.ingredients %></td>
  <% else %>
    <td class="text-color-not-ok"><%= product.name %></td>
    <% unless index_view %>
      <td class="text-color-not-ok"><%= product.ingredients %></td>
    <% else %>
      <% allergic_ingredients = product_reactions.select(:reactive_ingredient).distinct.pluck(:reactive_ingredient).join(', ') %>
      <td class="text-color-not-ok"><%= product.ingredients %><strong class='color-not-ok mark'> Contains: <%=allergic_ingredients%></strong></td>
    <% end %>
  <% end %>
  <% if index_view %>
    <td><%= link_to 'Edit', edit_product_path(product) %></td>
    <td><%= link_to 'Show', product_path(product) %></td>
    <td><%= link_to 'Delete', product_path(product), method: :delete, data: {confirm: "Are you sure?"} %></td>
  <% end %>
</tr>
