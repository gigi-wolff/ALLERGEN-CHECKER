<h1 class="center-heading">Products</h1>

<table class="table">
  <tr colspan="3">
    <th>Product</th>
    <th class='center'>Ingredients</th>
    <th class='center' colspan="3">Actions</th>
  </tr>
  <% @products.each do |product| %>
    <tr>
      <% product_reactions = Reaction.where("product_id = ?", product.id) %>
      <!-- for debugging... < % x=1/0 % >  -->
      <% if product_reactions.empty? %>
        <td class="color-ok"><%= product.name %></td>
        <td class="color-ok"><%= product.ingredients %></td>
      <% else %>
        <td class="color-not-ok"><%= product.name %></td>
        <% allergic_ingredients = product_reactions.select(:reactive_ingredient).distinct.pluck(:reactive_ingredient).join(', ') %>
        <td class="color-not-ok"><%= product.ingredients %><strong class='color-not-ok mark'> Contains: <%=allergic_ingredients%></strong></td>
      <% end %>
      <td><%= link_to 'Edit', edit_product_path(product) %></td>
      <td><%= link_to 'Show', product_path(product) %></td>
      <td><%= link_to 'Delete', product_path(product), method: :delete, data: {confirm: "Are you sure?"} %></td>
    </tr>
  <% end %>
</table>
<div class="center product-actions">
  <%= link_to "Create New Product", new_product_path, class: "btn btn-lg btn-primary" %>
</div>
<br>
<br>

